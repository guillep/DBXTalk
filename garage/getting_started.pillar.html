<!DOCTYPE html>
<html lang="en">
	<head>
    <meta charset='utf-8'>
    <title>Garage Driver Phase One</title>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  
  <body>
    <div class="container">
    	<div class="inner">
    	<header>
		  <img src="/images/dbxtalk.png" style="height:100px;float:left; margin-right: 10px" />
          <h1>dbxtalk</h1>
          <h2>Pharo Relational Database Suite</h2>
        </header>
    	
    		<section id="downloads" class="clearfix">
          <a href="https://github.com/guillep/DBXTalk/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/guillep/DBXTalk/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/guillep/DBXTalk" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
      	
<h2>1. Entering the Garage</h2>
<p>This article describes the basics of the garage database driver. It covers its basic usage: creating connections, connecting and closing them, and executing SQL queries. Details and particular features are discussed in other related articles.</p>
<h3>1.1. Getting a Connection</h3>
<p>The Garage database driver supports the creation of a connection through connection strings.</p>
<p><figure><pre><code class="Smalltalk">connection := GADriver fromConnectionString:
	'mysql://localhost:5432/sodbxtest?&amp;user=sodbxtest&amp;password=sodbxtest'.</code></pre><figcaption></figcaption></figure></p>
<p>Connection strings are URL styled:</p>
<ul><li> the schema (http, ftp, etc.) is the database driver id (we will talk about it later). In this example our schema is mysql.</li><li> host, port and database are the address of your database server</li><li> the query-string allows us to put additional information such as connection credentials. the key <strong>user</strong> is followed by the database user to login and the key <strong>password</strong> by its password.</li></ul>
<pre>driver://host:port/database?key=value&amp;key2=value2</pre>


<h3>1.2. Which are the drivers I have</h3>

<p>When we try to create a database connection with a driver that does not exist or we did not load yet, we will have an exception saying so.</p>
<p><figure><pre><code class="Smalltalk">GADriver fromConnectionString:
	'unexistent://localhost:3306/sodbxtest?user=sodbxtest&amp;password=sodbxtest'</code></pre><figcaption></figcaption></figure></p>
<p>To know which are the available drivers you have, you can ask it to the driver class. The driver class will answer with the ids of the available drivers. Drivers are automatically subscribed to a driver manager when they are loaded.</p>
<p><figure><pre><code class="Smalltalk">GADriver availableDrivers.
	&quot; =&gt; #(#mysql #opendbx #sqlite3 #postgresv2)&quot;</code></pre><figcaption></figcaption></figure></p>
<p>You can also ask it if a particular driver is available by providing it a database driver id. Database driver ids are case insensitive for the driver. Internally, they are all described by lowercase symbols, and will be transformed by the driver accordingly to that format when you query it with ids.</p>
<p><figure><pre><code class="Smalltalk">GADriver isAvailable: #mysql.
	&quot; =&gt; true&quot;
GADriver isAvailable: #MySQl.
	&quot; =&gt; true&quot;</code></pre><figcaption></figcaption></figure></p>
<h3>1.3. Stablishing connection</h3>
<p>Initially and to avoid surprises, a database connection is not connected to the database. You can check if a connection is connected at any time during the life of the connection using the isConnected message.</p>
<p><figure><pre><code class="Smalltalk">connection isConnected.
	&quot; =&gt; true/false&quot;</code></pre><figcaption></figcaption></figure></p>
<p>To activate the connection, we can send the <strong>connect</strong> message to it. If everything is allright (the database is available, username and passwords are correct) and the connection succedded we will receive no error. Instead, if a failure happened while trying to stablish the connection, it will raise an exception. Stablising manually the connection is useful to those users that want to parametrize the connection between its creation and its connection to the database. We will talk in more detail about connection settings later.</p>
<p><figure><pre><code class="Smalltalk">connection connect.</code></pre><figcaption></figcaption></figure></p>
<p>However, for those users that do not need to set manually parameters, he can use a shortcut that creates the connection and connects it in only one step.</p>
<p><figure><pre><code class="Smalltalk">connection := GADriver connectToConnectionString: 
	'mysql://localhost:3306/sodbxtest?user=sodbxtest&amp;password=sodbxtest'.</code></pre><figcaption></figcaption></figure></p>
<h3>1.4. Sending a Query</h3>
<p>Once a connection is available, we can send queries and statements to it for their execution. Here we will only see a simple query, using the execute message. We will describe in details how queries and their results are managed later.</p>
<p><figure><pre><code class="Smalltalk">connection execute: 'CREATE TABLE CATS (
	name varchar(50),
	owner varchar(50))'.

connection execute: 'SELECT * FROM CATS'.</code></pre><figcaption></figcaption></figure></p>
<p>Executing a correct query will return an accoding result: a select query will answer a result with rows, other statements will return a result with a summary of the action they did (e.g., an insert or update will return the amount of modified rows). Executing a wrong query will throw an exception explaining the problem. For example, a query with incorrect syntax will fail and tell us where is the syntax problem; querying an unexistent table will throw an error saying so. We will dive later into the expected kind of results.</p>

<h3>1.5. Closing the connection</h3>
<p>Database servers allow a limited number of simultaneous connections. If too many connections are open the server will start refusing new connections. To avoid these problems we have to close unused connections. Closing an unused connection will free used resources both in our Pharo image and in the database server. We can close manually a database connection by sending it the close message.</p>
<p><figure><pre><code class="Smalltalk">connection close.</code></pre><figcaption></figcaption></figure></p>
<p>Garage provides also the automatic closure of connections on garbage collection. That is, when a database connection object is being garbage collected, the connection will be automatically closed. To allow a database connection to be automatically collected, we must release all references to it. We must not keep references to a connection from any of our objects.</p>
      	</section>
		<footer>
          Dbxtalk is maintained by <a href="https://github.com/guillep">guillep</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
  </body>
</html>
