<!DOCTYPE html>
<html lang="en">
  <head profile="http://www.w3.org/2005/10/profile">
	<link rel="icon" 
      type="image/png" 
      href="/DBXTalk/images/favicon.png">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	
    <title>Garage</title>
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/DBXTalk/stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/DBXTalk/stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/DBXTalk/stylesheets/print.css" media="print">
	<script src="/DBXTalk/highlight/highlight.pack.js"></script>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
	<style>
	/* Sticky footer styles
	-------------------------------------------------- */
	html {
	  position: relative;
	  min-height: 100%;
	}
	body {
	  /* Margin bottom by footer height */
	  margin-bottom: 60px;
	}
	.footer {
	  position: absolute;
	  bottom: 3px;
	  width: 100%;
	  /* Set the fixed height of the footer here */
	  height: 60px;
	}


	/* Custom page CSS
	-------------------------------------------------- */
	/* Not required for template or sticky footer method. */

	body > .container {
	  padding: 60px 15px 0;
	}
	.container .text-muted {
	  margin: 20px 0;
	}

	.footer > .container {
	  padding-right: 15px;
	  padding-left: 15px;
	}

	code {
	  font-size: 80%;
	}
	
	</style>
	<style>
	/*** Custom Navigation Bar Style
	**** Autogenerated
	****
	***/
	/*Generated from: http://work.smarchal.com/twbscolor/css/9787ef715beaecf0f1ecdbff0*/
	.navbar-default {
	  background-color: #9787ef;
	  border-color: #715bea;
	}
	.navbar-default .navbar-brand {
	  color: #ecf0f1;
	}
	.navbar-default .navbar-brand:hover, .navbar-default .navbar-brand:focus {
	  color: #ecdbff;
	}
	.navbar-default .navbar-text {
	  color: #ecf0f1;
	}
	.navbar-default .navbar-nav > li > a {
	  color: #ecf0f1;
	}
	.navbar-default .navbar-nav > li > a:hover, .navbar-default .navbar-nav > li > a:focus {
	  color: #ecdbff;
	}
	.navbar-default .navbar-nav > .active > a, .navbar-default .navbar-nav > .active > a:hover, .navbar-default .navbar-nav > .active > a:focus {
	  color: #ecdbff;
	  background-color: #715bea;
	}
	.navbar-default .navbar-nav > .open > a, .navbar-default .navbar-nav > .open > a:hover, .navbar-default .navbar-nav > .open > a:focus {
	  color: #ecdbff;
	  background-color: #715bea;
	}
	.navbar-default .navbar-toggle {
	  border-color: #715bea;
	}
	.navbar-default .navbar-toggle:hover, .navbar-default .navbar-toggle:focus {
	  background-color: #715bea;
	}
	.navbar-default .navbar-toggle .icon-bar {
	  background-color: #ecf0f1;
	}
	.navbar-default .navbar-collapse,
	.navbar-default .navbar-form {
	  border-color: #ecf0f1;
	}
	.navbar-default .navbar-link {
	  color: #ecf0f1;
	}
	.navbar-default .navbar-link:hover {
	  color: #ecdbff;
	}

	@media (max-width: 767px) {
	  .navbar-default .navbar-nav .open .dropdown-menu > li > a {
	    color: #ecf0f1;
	  }
	  .navbar-default .navbar-nav .open .dropdown-menu > li > a:hover, .navbar-default .navbar-nav .open .dropdown-menu > li > a:focus {
	    color: #ecdbff;
	  }
	  .navbar-default .navbar-nav .open .dropdown-menu > .active > a, .navbar-default .navbar-nav .open .dropdown-menu > .active > a:hover, .navbar-default .navbar-nav .open .dropdown-menu > .active > a:focus {
	    color: #ecdbff;
	    background-color: #715bea;
	  }
	}
	</style>
  </head>
  
  <body style="padding-top:150px">
    <div class="container-fluid">
    	<div class="inner">
			<nav class="navbar navbar-default navbar-fixed-top">
			
	 		<header style="padding:10px;background-color:white;">
				<div style="width:700px;margin:0 auto;">
					<a href="/DBXTalk/" role="button">
			 			<img alt="dbxtalk" src="/DBXTalk/images/dbxtalk.png" style="height:100px;float:left;margin-right:10px">
					</a>
					<h1>dbxtalk</h1>
		 			<h2 style="margin:0px;">Pharo's relational database suite</h2>
				</div>
	 		</header>
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" style="width:700px;margin:0 auto;">
				  <ul class="nav navbar-nav">
					
					<li role="presentation" id="Home" >
						<a href="/DBXTalk/index.html" 
							>
							Home
							
						</a>
						
					</li>
					
					<li role="presentation" id="Garage" class="dropdown">
						<a href="" 
							class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
							Garage
							<span class="caret"></span>
						</a>
						
						<ul class="dropdown-menu" role="menu">
							
							<li role="presentation"><a href="/DBXTalk/garage/index.html">Overview</a></li>
							
							<li role="presentation"><a href="/DBXTalk/garage/installation.html">Installation</a></li>
							
							<li role="presentation"><a href="/DBXTalk/garage/getting_started.html">Getting Started</a></li>
							
							<li role="presentation"><a href="/DBXTalk/garage/drivers.html">Supported Drivers</a></li>
							
							<li role="presentation"><a href="/DBXTalk/garage/documentation.html">Documentation</a></li>
							
						</ul>
						
					</li>
					
					<li role="presentation" id="Glorp" >
						<a href="/DBXTalk/glorp.html" 
							>
							Glorp
							
						</a>
						
					</li>
					
					<li role="presentation" id="Contribute" >
						<a href="/DBXTalk/contribute.html" 
							>
							Contribute
							
						</a>
						
					</li>
					
					<li role="presentation" id="Contact" >
						<a href="/DBXTalk/contact.html" 
							>
							Contact
							
						</a>
						
					</li>
					
					</ul>
				</div>
			</nav>
        <hr>

        <section id="main_content">
      	<h3>Garage Connection Pool</h3>
<p>The package Garage-ConnectionPool implements a connection pool of garage connections. It implements the following basic features:</p><ul><li> connection recycling</li><li> purging of idle connections</li><li> configurable grow size</li><li> configurable connection validation through a block.</li></ul>
<p>This connection pool returns a GAPooledConnection, polymorphic to a normal garage connection. Upon close, the pooled connection is returned to the pool.</p>
<h3>Installation</h3>
<p>To load garage's connection pool, you can use it's metacello configuration which is published in Garage's repository. The current stable version is 0.1. You can load it using the following expression:</p>
<p><figure><pre><code class="Smalltalk">Gofer it
	smalltalkhubUser: 'DBXTalk' project: 'Garage';
	configurationOf: 'GarageConnectionPool';
	loadVersion: '0.1'.</code></pre><figcaption></figcaption></figure></p>
<p class="info">This configuration depends only on garage's core. It will not load a particular driver. If so is desired, please use the corresponding loading group in garage's configurartion to not bloat this configuration.</p>
<h3>Basic Usage</h3>
<p>A GAConnectionPool creates and serve connections as they are needed. We create and initialize a connection pool by using the <strong>forConnectionString:</strong> message with a connection string as argument.</p>
<p><figure><pre><code class="Smalltalk">pool := GAConnectionPool forConnectionString: 'postgresV2://localhost:5432/postgres?user=postgres&amp;password=postgres'.</code></pre><figcaption></figcaption></figure></p>
<p>Once we have a connection pool, we can ask it for a connection using the <strong>getConnection</strong> message.</p>
<p><figure><pre><code class="Smalltalk">pool := GAConnectionPool forConnectionString: 'postgresV2://localhost:5432/postgres?user=postgres&amp;password=postgres'.
connection := pool getConnection.</code></pre><figcaption></figcaption></figure></p>
<p>If no connections are available but it has space to create more connections, it will create a new connection with the given connection string. If it cannot serve a connection, it will throw an exception notifying so.</p>
<h3>Controlling the creation of connections</h3>
<p>To avoid creating too many database connections, we can control the maximum number of connections that a connection pool creates with the <strong>maxConnections:</strong> message. By default, the value of <strong>maxConnections</strong> is 20. This means, the connection pool will not create more than 20 connections. If we are in this limit and a user asks for a connection to the pool, the pool will try to return an already existing connection that is unused. If no available connections, it will throw an exception notifying so.</p>
<p><figure><pre><code class="Smalltalk">pool := GAConnectionPool forConnectionString: 'postgresV2://localhost:5432/postgres?user=postgres&amp;password=postgres'.

pool maxConnections: 2.

connection := pool getConnection.
	&quot; =&gt; a connection&quot;
anotherConnection := pool getConnection.
	&quot; =&gt; a different connection&quot;

pool getConnection.
	&quot; =&gt; An exception!&quot;</code></pre><figcaption></figcaption></figure></p>
<p>The garage connection pool also allows to control the rate in which connections are created. That is, connections are create in batches. By default these batches are of 1 connection. We can specify this rate using the <strong>growSize:</strong> message. Note that the grow rate will never make the pool grow over its configured maximum number of connections.</p>
<h3>Controlling idle connections</h3>
<p>To avoid having big numbers of unused or <em>idle</em> connections, we can configure the maximum amount of idle connections accepted by a connection pool using the <strong>maxIdleConnections:</strong> message. By default the garage connection pool allows 20 idle connections. Idle connections above this number will be closed automatically during the pool's <em>purge</em> phase. The pool's purge phase is executed when the number of returned connections since the last purge is the 75% of the maximum configured number of idle connections.</p>
<p><figure><pre><code class="Smalltalk">pool := GAConnectionPool forConnectionString: 'postgresV2://localhost:5432/postgres?user=postgres&amp;password=postgres'.
pool maxIdleConnections: 0.
connection := pool getConnection.
	&quot; =&gt; a new connection&quot;

&quot;We return the connection to the pool&quot;
connection close.

&quot;We ask for a connection&quot;
anotherConnection := pool getConnection.
	&quot; =&gt; a different connection.
	The old got closed because it was unused&quot;

pool getConnection.
	&quot; =&gt; An exception!&quot;</code></pre><figcaption></figcaption></figure></p>
<p>To decide if a connection is still valid or not during the purge phase, garage's connection pool asks by default to the connection if it is connected, using the <strong>isConnected</strong> message. We can customize this behavior by specifying a validation block with the <strong>validationBlock:</strong> message. The validation block can contain any arbitrary expression checking if the connection is valid or not. The connection pool will interpret the validation block as follows: 
 -A connection is considered alive if the validation block does not fail.
 -On the contrary, it will be considered invalid if the validation block throws an exception.</p>

<p>For example, we can customize the validation block as follows: 
<figure><pre><code class="Smalltalk">pool := GAConnectionPool forConnectionString: 'postgresV2://localhost:5432/postgres?user=postgres&amp;password=postgres'.
pool validationBlock: [ :connection | connection execute: 'SELECT 1+1;' ].</code></pre><figcaption></figcaption></figure></p>
      	</section>
		<footer class="footer">
          This website is developed using <a href="https://github.com/pillar-markup/pillar-documentation">Pillar</a><br>
          Theme based on tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>
      </div>
    </div>

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script>
	hljs.initHighlightingOnLoad();
	$("#Garage").addClass('active');
	function transformAnnotatedParagraphs(pClass) {
	    $("p." + pClass).wrap("<div class='alert alert-" + pClass + "' role='alert'/>" );
	};
	transformAnnotatedParagraphs('success');
	transformAnnotatedParagraphs('info');
	transformAnnotatedParagraphs('warning');
	transformAnnotatedParagraphs('danger');
	</script>
    
  </body>
</html>
